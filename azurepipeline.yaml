steps:
  - task: Lambdatest.lambda-azure-pipeline-extention.configuration-task.configuration@1
    displayName: LambdaTest configuration setup
    inputs:
      connection: Extent
  - script: >
      wget https://downloads.lambdatest.com/hyperexecute/darwin/hyperexecute

      chmod +x hyperexecute


      # Check the architecture of the binary

      file hyperexecute


      # Run the appropriate architecture based on the agent's architecture

      if [[ "$(uname -m)" == "x86_64" ]]; then
        ./hyperexecute --user anubhas --key JvGShZ2Bm8RdgmGFbbx4ZtbOb6DeQ8nqSvtHDZdDY7PzqaZMTq --config matrix.yaml --verbose
      else
        arch -arm64 ./hyperexecute --user anubhas --key JvGShZ2Bm8RdgmGFbbx4ZtbOb6DeQ8nqSvtHDZdDY7PzqaZMTq --config matrix.yaml --verbose
      fi
    displayName: Download and Run hyperexecute
